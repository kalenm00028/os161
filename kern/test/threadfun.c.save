runthreads(int doloud)
{
   char name[16];
   int i, result;

   for (i=0; i<=9; i++) {
      snprintf(name, sizeof(name), "threadtest%d", i);
      result = thread_fork(name, NULL,
                 doloud ? loudthread : quietthread,
                 NULL, i)
	;
      if (result) {
         panic("threadtest: thread_fork failed %s)\n",
               strerror(result));
      }
   }

   for (i=0; i<=9; i++) {
      P(tsem);
   }
}


int
threadtest(int nargs, char **args)
{
   (void)nargs;
   (void)args;

   init_sem();
   kprintf("Starting thread test...\n");
   runthreads(1);
   kprintf("\nThread test done.\n");

   return 0;
}
